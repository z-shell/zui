# Started from Zle or from command line

-zui_stdlib_cleanup
-zui_stdlib_init

ZUI[app]="zui-demo-fly"
ZUI[app_name]="ZUI On-The-Fly Regeneration"

emulate -LR zsh -o extendedglob -o typesetsilent -o warncreateglobal

[[ "${ZUI[PROMPT_SUBST]}" = "1" ]] && setopt promptsubst

-zui_stdlib_store_default_app_config b:border 1
-zui_stdlib_store_default_app_config b:status_border 1
-zui_stdlib_store_default_app_config b:text_mode 0

# Trick variable to make handler no-restart
local internal

# Generator for module 1
demo_mod1_generator() {
    local mod="$1" ice="$2"

    reply=()
    -zui_stdlib_rc_button "restart" "" "" ",mod1_ice1," "" "${ZUI[MAGENTA]}restart${ZUI[COLOR_END]}"
    -zui_stdlib_rc_button "on-the-fly" "" "" "" "" "${ZUI[MAGENTA]}on-the-fly${ZUI[COLOR_END]}" 'internal=1; -zui_stdlib_fly_mod_regen demo_mod1_generator "'"$mod"'" "'"$ice"'"'

    # Content
    reply=( "${ZUI[YELLOW]}ZUI${ZUI[COLOR_END]} can regenerate module instance with ${reply[1]} or ${reply[2]}!" "Random number: $RANDOM" )

    # Non-selectable lines  Hops to jump with [ and ]   Local anchors
    reply2=( 2 )            reply3=( 1 )                reply4=( )
}

# Show handler code in status window
-zui-standard-status-callback() {
    local tpe="$1" id="$2" data1="$3" data2="$4" data3="$5" data4="$6"
    [[ "$tpe" = "0" ]] && return 0 # Filter out non-hyperlinks

    id="${id#(zuiiaction|zuiaction|zuicheckbox|zuieanchor|zuianchor|zuitfield)}"
    handler="${ZUI[zuiiaction$id]}"
    reply=( "Handler: " "$handler" )

    # Resulting type: 1 - log message
    return 1
}

## Start application ##
zui-event-loop 1:demo_mod1_generator

-zui_stdlib_cleanup

return 0

# vim:ft=zsh
